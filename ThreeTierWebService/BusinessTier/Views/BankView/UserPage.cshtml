
@{
    ViewBag.Title = "UserPage";
}

<script src="~/Scripts/jquery-3.4.1.min.js"></script>


<h2>User Management</h2>
<div>
    <h3>Get Information For Existing Users</h3>
    <span>

    </span>
    <label for="userId">User ID:</label>
    <input id="infoUserId" name="userId" type="number" placeholder="UserPage Id" />
    <button id="getDetailsButton">Get Details</button>
    <button id="getAccountsButton">Get Accounts</button>
</div>
<div id="userInfoContent"></div>

<div>
    <h3>Creating New Users</h3>
    <form id="signupForm">
        <input name="DName" type="text" placeholder="First Name" />
        <input name="LName" type="text" placeholder="Last Name" />
        <button type="submit" style="display:block">Sign Up</button>
    </form>
    <div id="userCreatedDiv" hidden="true">
        <p>UserPage created successfully! Your ID is <a id="userCreatedLink" href="#">NULL</a></p>
    </div>
</div>


<template style="border-style: solid; margin: 8px" id="accountTemplate" href="#">
    <a href="#">
        <div>
            <p>Account ID: <text>NULL</text></p>
            <p>Balance: $<text>NULL</text></p>
        </div>
    </a>
</template>

<script>
    $("#getAccountsButton").on('click',
        () => {
            var userId = $("#infoUserId").val();

            $.ajax({
                url: `/api/user/${userId}/accounts`,
                type: 'GET',
                contentType: 'application/json; charset=utf-8',
                success: (data, textStatus, jQxhr) => {
                    console.log("Returned Accounts Data:");
                    console.log(data);
                    var accountsContainer = document.querySelector("#userInfoContent");
                    for (var accountElement in data) {
                        var template = document.querySelector('#accountTemplate');
                        var clone = template.content.cloneNode(true);

                        //Get all text tags in template
                        var elements = clone.querySelectorAll('text');

                        elements[0].textContent = data[accountElement].Id;
                        elements[1].textContent = data[accountElement].Balance;

                        //Set link
                        var link = clone.querySelector('a');
                        link.setAttribute('href', '/account/' + data[accountElement].Id);

                        //Set styling
                        var div = clone.querySelector('div');
                        div.setAttribute('style', "border-style:solid; border-color:black; padding:4px; margin:4px;")

                        accountsContainer.appendChild(clone);
                    }
                },
                error: (jqXhr, textStatus, errorThrown) => {
                    alert("Error! " + errorThrown);
                    console.log(errorThrown);
                }
            });
        });

    $("#createAcctForm").on('submit',
        (e) => {
            e.preventDefault();
            var formData = $("#createAcctForm").serializeArray();

            var postData = {
                UserId: formData[0].value
            };

            //Make API request
            $.ajax({
                url: '/api/account',
                type: 'POST',
                contentType: 'application/json; charset=utf-8',
                dataType: 'json',
                data: JSON.stringify(postData),
                success: (data, textStatus, jQxhr) => {
                    console.log("Account Create Data:");
                    console.log(data);

                    $("#accountCreatedDiv").toggle();
                    $("#accountCreatedLink").text(data.Id);
                    $("#accountCreatedLink").attr("href", `/account/${data.Id}`);

                },
                error: (jqXhr, textStatus, errorThrown) => {
                    alert("Error! " + errorThrown);
                    console.log(errorThrown);
                }
            });
        });
</script>